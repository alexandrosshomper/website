# /.htaccess at web root

RewriteEngine On

# Host-aware robots
SetEnvIfNoCase Host "^stage\.alexandrosshomper\.de$" BOTBLOCK=1
RewriteCond %{ENV:BOTBLOCK} =1
RewriteRule ^robots\.txt$ /robots-block.txt [L]
RewriteCond %{ENV:BOTBLOCK} !=1
RewriteRule ^robots\.txt$ /robots-allow.txt [L]
<IfModule mod_headers.c>
  Header always set X-Robots-Tag "noindex, nofollow, noarchive" env=BOTBLOCK
</IfModule>

# Force HTTPS for all hosts
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Route ONLY the main domain to /production
RewriteCond %{REQUEST_URI} !^/\.well-known/acme-challenge/ [NC]
RewriteCond %{REQUEST_URI} !^/production/ [NC]
RewriteCond %{HTTP_HOST} ^(www\.)?alexandrosshomper\.de$ [NC]
RewriteRule ^(.*)$ /production/$1 [L]